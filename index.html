<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <input type="text" name="pesquisa" id="pesquisa">

    <input type="checkbox" name="generos[]" id="Policial" class="generos" value="Policial">
    <label for="Policial">Policial</label>

    <input type="checkbox" name="generos[]" id="Drama" class="generos" value="Drama">
    <label for="Drama">Drama</label>

    <input type="checkbox" name="generos[]" id="Historico" class="generos" value="Histórico">
    <label for="Historico">Histórico</label>

    <input type="checkbox" name="generos[]" id="Guerra" class="generos" value="Guerra">
    <label for="Guerra">Guerra</label>

    <input type="checkbox" name="generos[]" id="Animacao" class="generos" value="Animação">
    <label for="Animacao">Animação</label>

    <input type="checkbox" name="generos[]" id="Aventura" class="generos" value="Aventura">
    <label for="Aventura">Aventura</label>

    <input type="checkbox" name="generos[]" id="Musical" class="generos" value="Musical">
    <label for="Musical">Musical</label>

    <button name="pesquisar" onclick="pesquisar()">Pesquisar</button>
    <div id="resultados"></div>
   
    <script>
        //url=`${url}?nome=${encodeURI(nome)}`;
        function html(dados){
            var generos = "";
            for(var j=0;j<(dados.genres).length;j++){
                generos +=dados.genres[j]+" ";
            }
           return `<div class="result">
            <img src=${dados.image} alt="">
            <p>Nome: ${dados.name}</p>
            <p>Gênero: ${generos}</p>
            <p>Descrição: ${dados.description}</p>
            <p>Data de publicação: ${dados.year_publication}</p>
            </div><br>
            `;
        }

        function pesquisar() {
            document.getElementById("resultados").innerHTML ="";
            var colecao = document.querySelectorAll("[name='generos[]']:checked");
            var filtros ="";
            var nome = "";
            var generosSelecionados = [];

            if(document.getElementById("pesquisa").value !=""){
                nome = `&nome=${encodeURI(document.getElementById("pesquisa").value)}`;
            }   
            
            colecao.forEach(inputGenero => {
                generosSelecionados.push(`generos[]=${inputGenero.value}`)
            })
            
            // for(var j=0;j<colecao.length;j++){
            //     if((colecao[j]).checked == true){
            //         generosSelecionados += colecao[j].value;
            //     }
            // }

            filtros += generosSelecionados.join("&");
            filtros += nome;
            
            var url = "http://localhost:8000/api.php";
            /*if(nome){
                filtros+= `?nome=${encodeURI(nome)}`;
            }

            if(generosSelecionados.length>0 && filtros !=""){
                filtros += `&generos=${generosSelecionados}`;
            }

            if(generosSelecionados.length>0 && filtros ==""){
                filtros += `?generos=${generosSelecionados}`;
            }*/
           var compl = "?"
            url = url + compl + filtros;

            fetch(url)
            .then(dados => dados.json())
            .then(dadosJson =>{
                if(dadosJson.status == "404"){
                    console.log(dadosJson.status);
                }else{
                    for(var i=0; i<dadosJson.length;i++){
                        document.getElementById("resultados").innerHTML += html(dadosJson[i]);
                    }
                    
                }
                
            })
        }
    </script>
</body>
</html>